<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>20&nbsp; Volatility Forecasting: GARCH â€“ Python for Data Science in Finance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/20_feed_grains_database/feed_grains_database.html" rel="next">
<link href="../../chapters/18_close_to_close/close_to_close.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-443a9a13d6c97aa3c21a69484c274cdc.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../parts/03_data_analysis/data_analysis.html">Data Analysis</a></li><li class="breadcrumb-item"><a href="../../chapters/19_garch/garch.html"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Volatility Forecasting: GARCH</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Python for Data Science in Finance</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/01_jumpstart/jumpstart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Python Jumpstart</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../parts/01_part_basic_data_wrangling/part_basic_data_wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/02_dataframe_basics/dataframe_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><code>DataFrame</code> Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/03_index_slice/index_slice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><code>DataFrame</code> Indexing and Slicing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/04_query/query.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><code>DataFrame</code> Querying</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/05_functions_apply/functions_apply.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Functions and the <code>DataFrame.apply()</code> Method</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/06_merge/merge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Merging <code>DataFrames</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/07_groupby_aggregation_part_1/groupby_aggregation_part_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><code>.groupby()</code> and <code>.agg()</code> - 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/08_groupby_aggregation_part_2/groupby_aggregation_part_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title"><code>.groupby()</code> and <code>.agg()</code> - 2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../parts/02_part_visualization/part_visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/09_pandas_line_graphs/pandas_line_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Line Graphs with <strong>pandas</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/10_pandas_bar_charts/pandas_bar_charts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bar Charts with <strong>pandas</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/11_pandas_scatter_plots/pandas_scatter_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Scatter Plots with <strong>pandas</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/12_seaborn/seaborn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualization with <strong>seaborn</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/13_bokeh_basic/bokeh_basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Basic Plotting with <strong>bokeh</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/14_bokeh_advanced/bokeh_advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Advanced Plotting with <strong>bokeh</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../parts/03_data_analysis/data_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/15a_option_replication/option_replication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Black-Scholes-Merton Option Replication</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/15b_asset_allocation/asset_allocation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Asset Allocation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/16_trend_following/trend_following.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Trend Following</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/17_regression_mutual_fund/regression_mutual_fund.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Regression: Mutual Fund Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/18_close_to_close/close_to_close.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Volatility Forecasting: Close-to-Close Estimator</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/19_garch/garch.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Volatility Forecasting: GARCH</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/20_feed_grains_database/feed_grains_database.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Exploration of the Feed Grains Database</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../parts/04_classical_machine_learning/classical_machine_learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classical Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/21_simple_linear_regression/simple_linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Simple Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/22_categorical_linear_regression/categorical_linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Linear Regression with Categorical Variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/23_ridge_lasso_regression/ridge_lasso_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Ridge and Lasso Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/24_k_nearest_neighbors_cross_validation/k_nearest_neighbors_cross_validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">K Nearest Neighbors &amp; Cross-Validation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/25_stock_prediction/stock_prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Predicting Stock Returns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/26a_pca/pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Principal Components Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/26b_principal_components_regression/principal_components_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Principal Components Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/26c_principal_components_logistic_regression/principal_components_logistic_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Principal Components Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/27_k_means_clustering/k_means_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">K-Means Clustering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/28_pca_visualization/pca_visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Visualizing Principal Components Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/29_student_loan_overfitting/student_loan_overfitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Student Loan: Overfitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/30_student_loan_alternative_metric/student_loan_alternative_metric.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Student Loan: Alternative Metric &amp; Cross-Validation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/31_student_loan_hyperparameter_tuning/student_loan_hyperparameter_tuning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Student Loan: Hyperparameter Tuning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/32_student_loan_xgboost/student_loan_xgboost.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Student Loan: <strong>xgboost</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/33_option_volume_introduction/option_volume_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Option Volume: Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/34_option_volume_feature_selection/option_volume_feature_selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Option Volume: Feature Selection and Hyperparameter Tuning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/35_option_volume_xgboost/option_volume_xgboost.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Option Volume: <strong>xgboost</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../parts/05_neural_networks/neural_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Neural Networks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/36a_mnist_digit_recognition/mnist_digit_recognition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">MNIST Digit Recognition</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/36b_imdb_classification/imdb_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">IMBD Movie Reviews</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/36c_reuters_classification/reuters_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Reuters: Classifying Newswires</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/36d_boston_house_price_regression/boston_house_price_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Boston Housing Prices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/37_student_loan_neural_network/student_loan_neural_network.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Student Loan: Neural Network</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/38_exchange_rate/exchange_rate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Exchange Rate Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/39_stock_prediction_neural_network/stock_prediction_neural_network.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Stock Returns: Neural Network</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/40_numerai/numerai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">Numerai</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/41_exchange_rate_rnn/exchange_rate_rnn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Exchange Rate: Recurrent Neural Network</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../parts/06_natural_language_processing/natural_language_processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Natural Language Processing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/41a_spacy_introduction/spacy_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">Introduction to <strong>spaCy</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/41b_nltk_introduction/nltk_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">Introduction to <strong>nltk</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/41c_vectorizing_text/vectorizing_text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title">Vectorizing Text</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/41d_sentiment_analysis_stock_headlines/sentiment_analysis_stock_headlines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">51</span>&nbsp; <span class="chapter-title">Sentiment Analysis on Stock Headlines</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../parts/07_miscellaneous/miscellaneous.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Miscellaneous</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/42_virtual_environments/virtual_environments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">52</span>&nbsp; <span class="chapter-title">Virtual Enviroments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/43_pipelines_pickles/pipelines_pickles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">53</span>&nbsp; <span class="chapter-title"><code>Pipelines</code> and <code>pickles</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/44_columntransformers/columntransformers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">54</span>&nbsp; <span class="chapter-title"><code>ColumnTransformers</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#loading-packages" id="toc-loading-packages" class="nav-link active" data-scroll-target="#loading-packages"><span class="header-section-number">20.1</span> Loading Packages</a></li>
  <li><a href="#spy-data-for-backtest-period" id="toc-spy-data-for-backtest-period" class="nav-link" data-scroll-target="#spy-data-for-backtest-period"><span class="header-section-number">20.2</span> SPY Data for Backtest Period</a></li>
  <li><a href="#organizing-dates" id="toc-organizing-dates" class="nav-link" data-scroll-target="#organizing-dates"><span class="header-section-number">20.3</span> Organizing Dates</a></li>
  <li><a href="#calculating-realized-volatility" id="toc-calculating-realized-volatility" class="nav-link" data-scroll-target="#calculating-realized-volatility"><span class="header-section-number">20.4</span> Calculating Realized Volatility</a></li>
  <li><a href="#garch-training-data" id="toc-garch-training-data" class="nav-link" data-scroll-target="#garch-training-data"><span class="header-section-number">20.5</span> GARCH Training Data</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">20.6</span> References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../parts/03_data_analysis/data_analysis.html">Data Analysis</a></li><li class="breadcrumb-item"><a href="../../chapters/19_garch/garch.html"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Volatility Forecasting: GARCH</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Volatility Forecasting: GARCH</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Financial asset returns exhibit volatility clustering (also called volatility regimes), as well as mean reversion. This means that high volatility periods beget high volatility periods, low volatility periods beget low volatility periods, and that volatility doesnâ€™t not converge to zero, or diverge to infinity. GARCH (generalized autoregressive conditional heteroskedasticity) time series models are popular for capturing these characteristics.</p>
<p>This chapter demonstrates code that implements a GARCH(1, 1) model using the <strong>arch</strong> package. We will view GARCH as a volatility prediction mechanism, and our interest will be on empirically determining the performance of GARCH relative to other prediction techniques (see the associated project).</p>
<p>In this chapter we will be focused exclusively on implementation, and thus we wonâ€™t be digging into the mathematical or statistical details of GARCH models (if you are interested, check out the references at the end). Specifically, we will generate some GARCH forecasts of SPY weekly volatility for the backtest period 1/1/2005 - 3/30/2016, and see how our results compare to Sepp 2016 (<em>Volatility Modeling and Trading</em>, pg 57).</p>
<section id="loading-packages" class="level2" data-number="20.1">
<h2 data-number="20.1" class="anchored" data-anchor-id="loading-packages"><span class="header-section-number">20.1</span> Loading Packages</h2>
<p>We begin by loading the packages and functions that we will need.</p>
<div id="cell-4" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> arch <span class="im">import</span> arch_model</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>yf.pdr_override()</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas_datareader <span class="im">import</span> data <span class="im">as</span> pdr</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_rows <span class="op">=</span> <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="spy-data-for-backtest-period" class="level2" data-number="20.2">
<h2 data-number="20.2" class="anchored" data-anchor-id="spy-data-for-backtest-period"><span class="header-section-number">20.2</span> SPY Data for Backtest Period</h2>
<p>Next, letâ€™s read-in the data for the backtest period.</p>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df_spy <span class="op">=</span> pdr.get_data_yahoo(<span class="st">'SPY'</span>, start <span class="op">=</span> <span class="st">'2004-12-31'</span>, end <span class="op">=</span> <span class="st">'2016-04-02'</span>).reset_index()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df_spy.columns <span class="op">=</span> df_spy.columns.<span class="bu">str</span>.lower().<span class="bu">str</span>.replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df_spy.rename(columns <span class="op">=</span> {<span class="st">'date'</span>:<span class="st">'trade_date'</span>}, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>df_spy.insert(<span class="dv">0</span>, <span class="st">'ticker'</span>, <span class="st">'SPY'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>df_spy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ticker</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">open</th>
<th data-quarto-table-cell-role="th">high</th>
<th data-quarto-table-cell-role="th">low</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">adj_close</th>
<th data-quarto-table-cell-role="th">volume</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SPY</td>
<td>2004-12-31</td>
<td>121.300003</td>
<td>121.660004</td>
<td>120.800003</td>
<td>120.870003</td>
<td>84.657822</td>
<td>28648800</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>SPY</td>
<td>2005-01-03</td>
<td>121.559998</td>
<td>121.760002</td>
<td>119.900002</td>
<td>120.300003</td>
<td>84.258591</td>
<td>55748000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>SPY</td>
<td>2005-01-04</td>
<td>120.459999</td>
<td>120.540001</td>
<td>118.440002</td>
<td>118.830002</td>
<td>83.229019</td>
<td>69167600</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>SPY</td>
<td>2005-01-05</td>
<td>118.739998</td>
<td>119.250000</td>
<td>118.000000</td>
<td>118.010002</td>
<td>82.654678</td>
<td>65667300</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>SPY</td>
<td>2005-01-06</td>
<td>118.440002</td>
<td>119.150002</td>
<td>118.260002</td>
<td>118.610001</td>
<td>83.074913</td>
<td>47814700</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2827</td>
<td>SPY</td>
<td>2016-03-28</td>
<td>203.610001</td>
<td>203.860001</td>
<td>202.710007</td>
<td>203.240005</td>
<td>178.770111</td>
<td>62408200</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2828</td>
<td>SPY</td>
<td>2016-03-29</td>
<td>202.759995</td>
<td>205.250000</td>
<td>202.399994</td>
<td>205.119995</td>
<td>180.423782</td>
<td>92922900</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2829</td>
<td>SPY</td>
<td>2016-03-30</td>
<td>206.300003</td>
<td>206.869995</td>
<td>205.589996</td>
<td>206.020004</td>
<td>181.215408</td>
<td>86365300</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2830</td>
<td>SPY</td>
<td>2016-03-31</td>
<td>205.910004</td>
<td>206.410004</td>
<td>205.330002</td>
<td>205.520004</td>
<td>180.775589</td>
<td>94584100</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2831</td>
<td>SPY</td>
<td>2016-04-01</td>
<td>204.350006</td>
<td>207.139999</td>
<td>203.979996</td>
<td>206.919998</td>
<td>182.007034</td>
<td>114423500</td>
</tr>
</tbody>
</table>

<p>2832 rows Ã— 8 columns</p>
</div>
</div>
</div>
<p>We will need the daily log returns, so letâ€™s calculate those now.</p>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_spy[<span class="st">'dly_ret'</span>] <span class="op">=</span> np.log(df_spy[<span class="st">'adj_close'</span>]).diff()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df_spy <span class="op">=</span> df_spy.dropna().reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df_spy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ticker</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">open</th>
<th data-quarto-table-cell-role="th">high</th>
<th data-quarto-table-cell-role="th">low</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">adj_close</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">dly_ret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SPY</td>
<td>2005-01-03</td>
<td>121.559998</td>
<td>121.760002</td>
<td>119.900002</td>
<td>120.300003</td>
<td>84.258591</td>
<td>55748000</td>
<td>-0.004727</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>SPY</td>
<td>2005-01-04</td>
<td>120.459999</td>
<td>120.540001</td>
<td>118.440002</td>
<td>118.830002</td>
<td>83.229019</td>
<td>69167600</td>
<td>-0.012294</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>SPY</td>
<td>2005-01-05</td>
<td>118.739998</td>
<td>119.250000</td>
<td>118.000000</td>
<td>118.010002</td>
<td>82.654678</td>
<td>65667300</td>
<td>-0.006925</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>SPY</td>
<td>2005-01-06</td>
<td>118.440002</td>
<td>119.150002</td>
<td>118.260002</td>
<td>118.610001</td>
<td>83.074913</td>
<td>47814700</td>
<td>0.005071</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>SPY</td>
<td>2005-01-07</td>
<td>118.970001</td>
<td>119.230003</td>
<td>118.129997</td>
<td>118.440002</td>
<td>82.955826</td>
<td>55847700</td>
<td>-0.001435</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2826</td>
<td>SPY</td>
<td>2016-03-28</td>
<td>203.610001</td>
<td>203.860001</td>
<td>202.710007</td>
<td>203.240005</td>
<td>178.770111</td>
<td>62408200</td>
<td>0.000591</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2827</td>
<td>SPY</td>
<td>2016-03-29</td>
<td>202.759995</td>
<td>205.250000</td>
<td>202.399994</td>
<td>205.119995</td>
<td>180.423782</td>
<td>92922900</td>
<td>0.009208</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2828</td>
<td>SPY</td>
<td>2016-03-30</td>
<td>206.300003</td>
<td>206.869995</td>
<td>205.589996</td>
<td>206.020004</td>
<td>181.215408</td>
<td>86365300</td>
<td>0.004378</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2829</td>
<td>SPY</td>
<td>2016-03-31</td>
<td>205.910004</td>
<td>206.410004</td>
<td>205.330002</td>
<td>205.520004</td>
<td>180.775589</td>
<td>94584100</td>
<td>-0.002430</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2830</td>
<td>SPY</td>
<td>2016-04-01</td>
<td>204.350006</td>
<td>207.139999</td>
<td>203.979996</td>
<td>206.919998</td>
<td>182.007034</td>
<td>114423500</td>
<td>0.006789</td>
</tr>
</tbody>
</table>

<p>2831 rows Ã— 9 columns</p>
</div>
</div>
</div>
</section>
<section id="organizing-dates" class="level2" data-number="20.3">
<h2 data-number="20.3" class="anchored" data-anchor-id="organizing-dates"><span class="header-section-number">20.3</span> Organizing Dates</h2>
<p>Letâ€™s organize our backtest period into weeks (Monday - Friday), since our analysis is of weekly volatility predictions.</p>
<div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adding a new columns consisting of the weekday number for each trade_date </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>weekday <span class="op">=</span> df_spy[<span class="st">'trade_date'</span>].dt.weekday</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># assigning a week number to each trade-date; M-F is all the same week</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>week_num <span class="op">=</span> []</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>ix_week <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>week_num.append(ix_week)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ix <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(weekday) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    prev_day <span class="op">=</span> weekday.iloc[ix]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    curr_day <span class="op">=</span> weekday.iloc[ix <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> curr_day <span class="op">&lt;</span> prev_day:</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        ix_week <span class="op">=</span> ix_week <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    week_num.append(ix_week)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># inserting the week-number column into df_spy</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>df_spy.insert(<span class="dv">2</span>, <span class="st">'week_num'</span>, week_num)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>df_spy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ticker</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">week_num</th>
<th data-quarto-table-cell-role="th">open</th>
<th data-quarto-table-cell-role="th">high</th>
<th data-quarto-table-cell-role="th">low</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">adj_close</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">dly_ret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SPY</td>
<td>2005-01-03</td>
<td>0</td>
<td>121.559998</td>
<td>121.760002</td>
<td>119.900002</td>
<td>120.300003</td>
<td>84.258591</td>
<td>55748000</td>
<td>-0.004727</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>SPY</td>
<td>2005-01-04</td>
<td>0</td>
<td>120.459999</td>
<td>120.540001</td>
<td>118.440002</td>
<td>118.830002</td>
<td>83.229019</td>
<td>69167600</td>
<td>-0.012294</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>SPY</td>
<td>2005-01-05</td>
<td>0</td>
<td>118.739998</td>
<td>119.250000</td>
<td>118.000000</td>
<td>118.010002</td>
<td>82.654678</td>
<td>65667300</td>
<td>-0.006925</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>SPY</td>
<td>2005-01-06</td>
<td>0</td>
<td>118.440002</td>
<td>119.150002</td>
<td>118.260002</td>
<td>118.610001</td>
<td>83.074913</td>
<td>47814700</td>
<td>0.005071</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>SPY</td>
<td>2005-01-07</td>
<td>0</td>
<td>118.970001</td>
<td>119.230003</td>
<td>118.129997</td>
<td>118.440002</td>
<td>82.955826</td>
<td>55847700</td>
<td>-0.001435</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2826</td>
<td>SPY</td>
<td>2016-03-28</td>
<td>586</td>
<td>203.610001</td>
<td>203.860001</td>
<td>202.710007</td>
<td>203.240005</td>
<td>178.770111</td>
<td>62408200</td>
<td>0.000591</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2827</td>
<td>SPY</td>
<td>2016-03-29</td>
<td>586</td>
<td>202.759995</td>
<td>205.250000</td>
<td>202.399994</td>
<td>205.119995</td>
<td>180.423782</td>
<td>92922900</td>
<td>0.009208</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2828</td>
<td>SPY</td>
<td>2016-03-30</td>
<td>586</td>
<td>206.300003</td>
<td>206.869995</td>
<td>205.589996</td>
<td>206.020004</td>
<td>181.215408</td>
<td>86365300</td>
<td>0.004378</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2829</td>
<td>SPY</td>
<td>2016-03-31</td>
<td>586</td>
<td>205.910004</td>
<td>206.410004</td>
<td>205.330002</td>
<td>205.520004</td>
<td>180.775589</td>
<td>94584100</td>
<td>-0.002430</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2830</td>
<td>SPY</td>
<td>2016-04-01</td>
<td>586</td>
<td>204.350006</td>
<td>207.139999</td>
<td>203.979996</td>
<td>206.919998</td>
<td>182.007034</td>
<td>114423500</td>
<td>0.006789</td>
</tr>
</tbody>
</table>

<p>2831 rows Ã— 10 columns</p>
</div>
</div>
</div>
<p>The following code generates a <code>DataFrame</code> that contains the start-date and end-date for each week.</p>
<div id="cell-14" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_start_end <span class="op">=</span> <span class="op">\</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    df_spy.groupby([<span class="st">'week_num'</span>], as_index <span class="op">=</span> <span class="va">False</span>)[[<span class="st">'trade_date'</span>]].agg([<span class="bu">min</span>, <span class="bu">max</span>])[<span class="st">'trade_date'</span>]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    .rename(columns <span class="op">=</span> {<span class="st">'min'</span>:<span class="st">'week_start'</span>, <span class="st">'max'</span>:<span class="st">'week_end'</span>})</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    .rename(columns <span class="op">=</span> {<span class="st">'index'</span>:<span class="st">'week_num'</span>})</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>df_start_end</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">week_num</th>
<th data-quarto-table-cell-role="th">week_start</th>
<th data-quarto-table-cell-role="th">week_end</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>2005-01-03</td>
<td>2005-01-07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>2005-01-10</td>
<td>2005-01-14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>2005-01-18</td>
<td>2005-01-21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>2005-01-24</td>
<td>2005-01-28</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>2005-01-31</td>
<td>2005-02-04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">582</td>
<td>582</td>
<td>2016-02-29</td>
<td>2016-03-04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">583</td>
<td>583</td>
<td>2016-03-07</td>
<td>2016-03-11</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">584</td>
<td>584</td>
<td>2016-03-14</td>
<td>2016-03-18</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">585</td>
<td>585</td>
<td>2016-03-21</td>
<td>2016-03-24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">586</td>
<td>586</td>
<td>2016-03-28</td>
<td>2016-04-01</td>
</tr>
</tbody>
</table>

<p>587 rows Ã— 3 columns</p>
</div>
</div>
</div>
<p>And finally letâ€™s join the weekly start/end dates into <code>df_spy</code>.</p>
<div id="cell-16" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_spy <span class="op">=</span> df_spy.merge(df_start_end)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df_spy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ticker</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">week_num</th>
<th data-quarto-table-cell-role="th">open</th>
<th data-quarto-table-cell-role="th">high</th>
<th data-quarto-table-cell-role="th">low</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">adj_close</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">dly_ret</th>
<th data-quarto-table-cell-role="th">week_start</th>
<th data-quarto-table-cell-role="th">week_end</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SPY</td>
<td>2005-01-03</td>
<td>0</td>
<td>121.559998</td>
<td>121.760002</td>
<td>119.900002</td>
<td>120.300003</td>
<td>84.258591</td>
<td>55748000</td>
<td>-0.004727</td>
<td>2005-01-03</td>
<td>2005-01-07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>SPY</td>
<td>2005-01-04</td>
<td>0</td>
<td>120.459999</td>
<td>120.540001</td>
<td>118.440002</td>
<td>118.830002</td>
<td>83.229019</td>
<td>69167600</td>
<td>-0.012294</td>
<td>2005-01-03</td>
<td>2005-01-07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>SPY</td>
<td>2005-01-05</td>
<td>0</td>
<td>118.739998</td>
<td>119.250000</td>
<td>118.000000</td>
<td>118.010002</td>
<td>82.654678</td>
<td>65667300</td>
<td>-0.006925</td>
<td>2005-01-03</td>
<td>2005-01-07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>SPY</td>
<td>2005-01-06</td>
<td>0</td>
<td>118.440002</td>
<td>119.150002</td>
<td>118.260002</td>
<td>118.610001</td>
<td>83.074913</td>
<td>47814700</td>
<td>0.005071</td>
<td>2005-01-03</td>
<td>2005-01-07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>SPY</td>
<td>2005-01-07</td>
<td>0</td>
<td>118.970001</td>
<td>119.230003</td>
<td>118.129997</td>
<td>118.440002</td>
<td>82.955826</td>
<td>55847700</td>
<td>-0.001435</td>
<td>2005-01-03</td>
<td>2005-01-07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2826</td>
<td>SPY</td>
<td>2016-03-28</td>
<td>586</td>
<td>203.610001</td>
<td>203.860001</td>
<td>202.710007</td>
<td>203.240005</td>
<td>178.770111</td>
<td>62408200</td>
<td>0.000591</td>
<td>2016-03-28</td>
<td>2016-04-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2827</td>
<td>SPY</td>
<td>2016-03-29</td>
<td>586</td>
<td>202.759995</td>
<td>205.250000</td>
<td>202.399994</td>
<td>205.119995</td>
<td>180.423782</td>
<td>92922900</td>
<td>0.009208</td>
<td>2016-03-28</td>
<td>2016-04-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2828</td>
<td>SPY</td>
<td>2016-03-30</td>
<td>586</td>
<td>206.300003</td>
<td>206.869995</td>
<td>205.589996</td>
<td>206.020004</td>
<td>181.215408</td>
<td>86365300</td>
<td>0.004378</td>
<td>2016-03-28</td>
<td>2016-04-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2829</td>
<td>SPY</td>
<td>2016-03-31</td>
<td>586</td>
<td>205.910004</td>
<td>206.410004</td>
<td>205.330002</td>
<td>205.520004</td>
<td>180.775589</td>
<td>94584100</td>
<td>-0.002430</td>
<td>2016-03-28</td>
<td>2016-04-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2830</td>
<td>SPY</td>
<td>2016-04-01</td>
<td>586</td>
<td>204.350006</td>
<td>207.139999</td>
<td>203.979996</td>
<td>206.919998</td>
<td>182.007034</td>
<td>114423500</td>
<td>0.006789</td>
<td>2016-03-28</td>
<td>2016-04-01</td>
</tr>
</tbody>
</table>

<p>2831 rows Ã— 12 columns</p>
</div>
</div>
</div>
</section>
<section id="calculating-realized-volatility" class="level2" data-number="20.4">
<h2 data-number="20.4" class="anchored" data-anchor-id="calculating-realized-volatility"><span class="header-section-number">20.4</span> Calculating Realized Volatility</h2>
<p>This code cell calculates the realized volatility for each week. In machine learning parlance, these are the labels that we are trying to predict.</p>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df_realized <span class="op">=</span> <span class="op">\</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    df_spy</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'week_num'</span>, <span class="st">'week_start'</span>, <span class="st">'week_end'</span>], as_index <span class="op">=</span> <span class="va">False</span>)[[<span class="st">'dly_ret'</span>]].agg(<span class="kw">lambda</span> x: np.std(x) <span class="op">*</span> np.sqrt(<span class="dv">252</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        .rename(columns <span class="op">=</span> {<span class="st">'dly_ret'</span>:<span class="st">'realized_vol'</span>})</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>df_realized <span class="op">=</span> df_realized[<span class="dv">1</span>:]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>df_realized</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">week_num</th>
<th data-quarto-table-cell-role="th">week_start</th>
<th data-quarto-table-cell-role="th">week_end</th>
<th data-quarto-table-cell-role="th">realized_vol</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>2005-01-10</td>
<td>2005-01-14</td>
<td>0.093297</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>2005-01-18</td>
<td>2005-01-21</td>
<td>0.126558</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>2005-01-24</td>
<td>2005-01-28</td>
<td>0.029752</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>2005-01-31</td>
<td>2005-02-04</td>
<td>0.069585</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>5</td>
<td>2005-02-07</td>
<td>2005-02-11</td>
<td>0.084566</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">582</td>
<td>582</td>
<td>2016-02-29</td>
<td>2016-03-04</td>
<td>0.159052</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">583</td>
<td>583</td>
<td>2016-03-07</td>
<td>2016-03-11</td>
<td>0.137589</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">584</td>
<td>584</td>
<td>2016-03-14</td>
<td>2016-03-18</td>
<td>0.054367</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">585</td>
<td>585</td>
<td>2016-03-21</td>
<td>2016-03-24</td>
<td>0.048135</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">586</td>
<td>586</td>
<td>2016-03-28</td>
<td>2016-04-01</td>
<td>0.066439</td>
</tr>
</tbody>
</table>

<p>586 rows Ã— 4 columns</p>
</div>
</div>
</div>
</section>
<section id="garch-training-data" class="level2" data-number="20.5">
<h2 data-number="20.5" class="anchored" data-anchor-id="garch-training-data"><span class="header-section-number">20.5</span> GARCH Training Data</h2>
<p>A practical rule of thumb for fitting garch models to equity index returns is that you should use 5-10 years worth of data. In this tutorial we will use 10-years worth.</p>
<p>Letâ€™s begin by grabbing all the data that we will need for fitting.</p>
<div id="cell-22" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> pdr.get_data_yahoo(<span class="st">'SPY'</span>, start <span class="op">=</span> <span class="st">'1994-12-30'</span>, end <span class="op">=</span> <span class="st">'2016-04-02'</span>).reset_index()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df_train.columns <span class="op">=</span> df_train.columns.<span class="bu">str</span>.lower().<span class="bu">str</span>.replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df_train.rename(columns <span class="op">=</span> {<span class="st">'date'</span>:<span class="st">'trade_date'</span>}, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>df_train.insert(<span class="dv">0</span>, <span class="st">'ticker'</span>, <span class="st">'SPY'</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>df_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ticker</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">open</th>
<th data-quarto-table-cell-role="th">high</th>
<th data-quarto-table-cell-role="th">low</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">adj_close</th>
<th data-quarto-table-cell-role="th">volume</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SPY</td>
<td>1994-12-30</td>
<td>46.203125</td>
<td>46.250000</td>
<td>45.562500</td>
<td>45.562500</td>
<td>27.317329</td>
<td>2209500</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>SPY</td>
<td>1995-01-03</td>
<td>45.703125</td>
<td>45.843750</td>
<td>45.687500</td>
<td>45.781250</td>
<td>27.448469</td>
<td>324300</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>SPY</td>
<td>1995-01-04</td>
<td>45.984375</td>
<td>46.000000</td>
<td>45.750000</td>
<td>46.000000</td>
<td>27.579622</td>
<td>351800</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>SPY</td>
<td>1995-01-05</td>
<td>46.031250</td>
<td>46.109375</td>
<td>45.953125</td>
<td>46.000000</td>
<td>27.579622</td>
<td>89800</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>SPY</td>
<td>1995-01-06</td>
<td>46.093750</td>
<td>46.250000</td>
<td>45.906250</td>
<td>46.046875</td>
<td>27.607731</td>
<td>448400</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5346</td>
<td>SPY</td>
<td>2016-03-28</td>
<td>203.610001</td>
<td>203.860001</td>
<td>202.710007</td>
<td>203.240005</td>
<td>178.770142</td>
<td>62408200</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5347</td>
<td>SPY</td>
<td>2016-03-29</td>
<td>202.759995</td>
<td>205.250000</td>
<td>202.399994</td>
<td>205.119995</td>
<td>180.423767</td>
<td>92922900</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5348</td>
<td>SPY</td>
<td>2016-03-30</td>
<td>206.300003</td>
<td>206.869995</td>
<td>205.589996</td>
<td>206.020004</td>
<td>181.215424</td>
<td>86365300</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5349</td>
<td>SPY</td>
<td>2016-03-31</td>
<td>205.910004</td>
<td>206.410004</td>
<td>205.330002</td>
<td>205.520004</td>
<td>180.775589</td>
<td>94584100</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5350</td>
<td>SPY</td>
<td>2016-04-01</td>
<td>204.350006</td>
<td>207.139999</td>
<td>203.979996</td>
<td>206.919998</td>
<td>182.007050</td>
<td>114423500</td>
</tr>
</tbody>
</table>

<p>5351 rows Ã— 8 columns</p>
</div>
</div>
</div>
<p>Next we calculate the daily returns.</p>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_train[<span class="st">'dly_ret'</span>] <span class="op">=</span> np.log(df_train[<span class="st">'adj_close'</span>]).diff()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df_train.dropna(inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df_train.reset_index(drop <span class="op">=</span> <span class="va">True</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>df_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ticker</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">open</th>
<th data-quarto-table-cell-role="th">high</th>
<th data-quarto-table-cell-role="th">low</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">adj_close</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">dly_ret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SPY</td>
<td>1995-01-03</td>
<td>45.703125</td>
<td>45.843750</td>
<td>45.687500</td>
<td>45.781250</td>
<td>27.448469</td>
<td>324300</td>
<td>0.004789</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>SPY</td>
<td>1995-01-04</td>
<td>45.984375</td>
<td>46.000000</td>
<td>45.750000</td>
<td>46.000000</td>
<td>27.579622</td>
<td>351800</td>
<td>0.004767</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>SPY</td>
<td>1995-01-05</td>
<td>46.031250</td>
<td>46.109375</td>
<td>45.953125</td>
<td>46.000000</td>
<td>27.579622</td>
<td>89800</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>SPY</td>
<td>1995-01-06</td>
<td>46.093750</td>
<td>46.250000</td>
<td>45.906250</td>
<td>46.046875</td>
<td>27.607731</td>
<td>448400</td>
<td>0.001019</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>SPY</td>
<td>1995-01-09</td>
<td>46.031250</td>
<td>46.093750</td>
<td>46.000000</td>
<td>46.093750</td>
<td>27.635849</td>
<td>36800</td>
<td>0.001018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5345</td>
<td>SPY</td>
<td>2016-03-28</td>
<td>203.610001</td>
<td>203.860001</td>
<td>202.710007</td>
<td>203.240005</td>
<td>178.770142</td>
<td>62408200</td>
<td>0.000591</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5346</td>
<td>SPY</td>
<td>2016-03-29</td>
<td>202.759995</td>
<td>205.250000</td>
<td>202.399994</td>
<td>205.119995</td>
<td>180.423767</td>
<td>92922900</td>
<td>0.009207</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5347</td>
<td>SPY</td>
<td>2016-03-30</td>
<td>206.300003</td>
<td>206.869995</td>
<td>205.589996</td>
<td>206.020004</td>
<td>181.215424</td>
<td>86365300</td>
<td>0.004378</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5348</td>
<td>SPY</td>
<td>2016-03-31</td>
<td>205.910004</td>
<td>206.410004</td>
<td>205.330002</td>
<td>205.520004</td>
<td>180.775589</td>
<td>94584100</td>
<td>-0.002430</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5349</td>
<td>SPY</td>
<td>2016-04-01</td>
<td>204.350006</td>
<td>207.139999</td>
<td>203.979996</td>
<td>206.919998</td>
<td>182.007050</td>
<td>114423500</td>
<td>0.006789</td>
</tr>
</tbody>
</table>

<p>5350 rows Ã— 9 columns</p>
</div>
</div>
</div>
<p>The GARCH fitting process has better convergence if we express the returns as percents rather than decimals.</p>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ser_returns <span class="op">=</span> df_train[<span class="st">'dly_ret'</span>] <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>ser_returns.index <span class="op">=</span> df_train[<span class="st">'trade_date'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we instantiate the model.</p>
<div id="cell-28" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> arch_model(ser_returns, vol <span class="op">=</span> <span class="st">'Garch'</span>, p <span class="op">=</span> <span class="dv">1</span>, o <span class="op">=</span> <span class="dv">0</span>, q <span class="op">=</span> <span class="dv">1</span>, dist <span class="op">=</span> <span class="st">'Normal'</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> model.fit(update_freq <span class="op">=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration:      5,   Func. Count:     37,   Neg. LLF: 7624.3614767949375
Iteration:     10,   Func. Count:     65,   Neg. LLF: 7598.333575044246
Optimization terminated successfully    (Exit mode 0)
            Current function value: 7598.333533861198
            Iterations: 12
            Function evaluations: 75
            Gradient evaluations: 12</code></pre>
</div>
</div>
<p>The following code loops through and performs the fitting for each day. It takes a while to run, so Iâ€™ll leave it to you to run it and examine on your own time. See the package documentation linked below for details - you will probably need to read those in order to complete the associated project.</p>
<div id="cell-31" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ix_start = df_train.query('trade_date == trade_date.min()').index[0]</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ix_end = df_train.query('trade_date == "2004-12-31"').index[0]</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># forecasts = {}</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for ix in range(2518, 5349):</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     sys.stdout.write('.')</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     sys.stdout.flush()</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     result = model.fit(first_obs = (ix - 2518), last_obs = ix, disp = 'off')</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     temp = result.forecast(horizon = 5, reindex = True).variance</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     fcast = temp.iloc[ix - 1]</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     forecasts[fcast.name] = fcast</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># print()</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># df_forecast = pd.DataFrame(pd.DataFrame(forecasts).T)</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># df_forecast = df_forecast.reset_index().rename(columns = {'index':'trade_date'})</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># df_forecast</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # writing variance estimates to csv-file</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co"># df_forecast.to_csv('variance_forecast.csv', index = False)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The above code saves the variance estimates to a CSV file, and we will read those in now.</p>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_forecast <span class="op">=</span> pd.read_csv(<span class="st">'variance_forecast.csv'</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df_forecast[<span class="st">'trade_date'</span>] <span class="op">=</span> pd.to_datetime(df_forecast[<span class="st">'trade_date'</span>])</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>df_forecast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">h.1</th>
<th data-quarto-table-cell-role="th">h.2</th>
<th data-quarto-table-cell-role="th">h.3</th>
<th data-quarto-table-cell-role="th">h.4</th>
<th data-quarto-table-cell-role="th">h.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2004-12-30</td>
<td>0.312152</td>
<td>0.320800</td>
<td>0.329415</td>
<td>0.337999</td>
<td>0.346551</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2004-12-31</td>
<td>0.303715</td>
<td>0.312426</td>
<td>0.321104</td>
<td>0.329750</td>
<td>0.338364</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2005-01-03</td>
<td>0.313479</td>
<td>0.322231</td>
<td>0.330949</td>
<td>0.339635</td>
<td>0.348287</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2005-01-04</td>
<td>0.433124</td>
<td>0.441654</td>
<td>0.450148</td>
<td>0.458607</td>
<td>0.467031</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2005-01-05</td>
<td>0.453912</td>
<td>0.462365</td>
<td>0.470782</td>
<td>0.479165</td>
<td>0.487513</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2826</td>
<td>2016-03-23</td>
<td>0.578104</td>
<td>0.593060</td>
<td>0.607729</td>
<td>0.622115</td>
<td>0.636224</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2827</td>
<td>2016-03-24</td>
<td>0.527753</td>
<td>0.543716</td>
<td>0.559369</td>
<td>0.574720</td>
<td>0.589773</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2828</td>
<td>2016-03-28</td>
<td>0.482408</td>
<td>0.499278</td>
<td>0.515820</td>
<td>0.532041</td>
<td>0.547947</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2829</td>
<td>2016-03-29</td>
<td>0.526633</td>
<td>0.542651</td>
<td>0.558358</td>
<td>0.573760</td>
<td>0.588863</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2830</td>
<td>2016-03-30</td>
<td>0.496876</td>
<td>0.513525</td>
<td>0.529849</td>
<td>0.545856</td>
<td>0.561551</td>
</tr>
</tbody>
</table>

<p>2831 rows Ã— 6 columns</p>
</div>
</div>
</div>
<p>The columns of the <code>df_forecast</code> are the one day variance estimates for the next five days. In order to calculate a 5-day volatility forecasts we will add up these columns, divide by 100 (the variances are stated as percentages), and then take a square-root.</p>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_forecast[<span class="st">'volatility_forecast'</span>] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    np.sqrt((df_forecast[<span class="st">'h.1'</span>] <span class="op">+</span> df_forecast[<span class="st">'h.2'</span>] <span class="op">+</span> df_forecast[<span class="st">'h.3'</span>] <span class="op">+</span> df_forecast[<span class="st">'h.4'</span>] <span class="op">+</span> df_forecast[<span class="st">'h.5'</span>]) <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df_forecast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">h.1</th>
<th data-quarto-table-cell-role="th">h.2</th>
<th data-quarto-table-cell-role="th">h.3</th>
<th data-quarto-table-cell-role="th">h.4</th>
<th data-quarto-table-cell-role="th">h.5</th>
<th data-quarto-table-cell-role="th">volatility_forecast</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2004-12-30</td>
<td>0.312152</td>
<td>0.320800</td>
<td>0.329415</td>
<td>0.337999</td>
<td>0.346551</td>
<td>0.128332</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2004-12-31</td>
<td>0.303715</td>
<td>0.312426</td>
<td>0.321104</td>
<td>0.329750</td>
<td>0.338364</td>
<td>0.126703</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2005-01-03</td>
<td>0.313479</td>
<td>0.322231</td>
<td>0.330949</td>
<td>0.339635</td>
<td>0.348287</td>
<td>0.128630</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2005-01-04</td>
<td>0.433124</td>
<td>0.441654</td>
<td>0.450148</td>
<td>0.458607</td>
<td>0.467031</td>
<td>0.150019</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2005-01-05</td>
<td>0.453912</td>
<td>0.462365</td>
<td>0.470782</td>
<td>0.479165</td>
<td>0.487513</td>
<td>0.153419</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2826</td>
<td>2016-03-23</td>
<td>0.578104</td>
<td>0.593060</td>
<td>0.607729</td>
<td>0.622115</td>
<td>0.636224</td>
<td>0.174277</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2827</td>
<td>2016-03-24</td>
<td>0.527753</td>
<td>0.543716</td>
<td>0.559369</td>
<td>0.574720</td>
<td>0.589773</td>
<td>0.167192</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2828</td>
<td>2016-03-28</td>
<td>0.482408</td>
<td>0.499278</td>
<td>0.515820</td>
<td>0.532041</td>
<td>0.547947</td>
<td>0.160546</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2829</td>
<td>2016-03-29</td>
<td>0.526633</td>
<td>0.542651</td>
<td>0.558358</td>
<td>0.573760</td>
<td>0.588863</td>
<td>0.167041</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2830</td>
<td>2016-03-30</td>
<td>0.496876</td>
<td>0.513525</td>
<td>0.529849</td>
<td>0.545856</td>
<td>0.561551</td>
<td>0.162716</td>
</tr>
</tbody>
</table>

<p>2831 rows Ã— 7 columns</p>
</div>
</div>
</div>
<p>Letâ€™s plot these forecasts to make sure that they look reasonable.</p>
<div id="cell-37" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_forecast.plot(x <span class="op">=</span> <span class="st">'trade_date'</span>, y <span class="op">=</span> <span class="st">'volatility_forecast'</span>, figsize <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">6</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="garch_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We actually have far more forecasts than we need, because we calculated forecasts for each day. We can isolate the ones in question by using a join.</p>
<div id="cell-39" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df_start_end.merge(df_forecast[[<span class="st">'trade_date'</span>, <span class="st">'volatility_forecast'</span>]], left_on <span class="op">=</span> <span class="st">'week_end'</span>, right_on <span class="op">=</span> <span class="st">'trade_date'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">week_num</th>
<th data-quarto-table-cell-role="th">week_start</th>
<th data-quarto-table-cell-role="th">week_end</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">volatility_forecast</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>2005-01-03</td>
<td>2005-01-07</td>
<td>2005-01-07</td>
<td>0.147481</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>2005-01-10</td>
<td>2005-01-14</td>
<td>2005-01-14</td>
<td>0.150795</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>2005-01-18</td>
<td>2005-01-21</td>
<td>2005-01-21</td>
<td>0.170141</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>2005-01-24</td>
<td>2005-01-28</td>
<td>2005-01-28</td>
<td>0.147867</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>2005-01-31</td>
<td>2005-02-04</td>
<td>2005-02-04</td>
<td>0.151963</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">581</td>
<td>581</td>
<td>2016-02-22</td>
<td>2016-02-26</td>
<td>2016-02-26</td>
<td>0.250594</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">582</td>
<td>582</td>
<td>2016-02-29</td>
<td>2016-03-04</td>
<td>2016-03-04</td>
<td>0.242543</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">583</td>
<td>583</td>
<td>2016-03-07</td>
<td>2016-03-11</td>
<td>2016-03-11</td>
<td>0.230967</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">584</td>
<td>584</td>
<td>2016-03-14</td>
<td>2016-03-18</td>
<td>2016-03-18</td>
<td>0.188825</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">585</td>
<td>585</td>
<td>2016-03-21</td>
<td>2016-03-24</td>
<td>2016-03-24</td>
<td>0.167192</td>
</tr>
</tbody>
</table>

<p>586 rows Ã— 5 columns</p>
</div>
</div>
</div>
<p>Letâ€™s grab the forecasts and put them into their own variable.</p>
<div id="cell-41" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>volatility_forecasts <span class="op">=</span> df_start_end.merge(df_forecast, left_on <span class="op">=</span> <span class="st">'week_end'</span>, right_on <span class="op">=</span> <span class="st">'trade_date'</span>)[<span class="st">'volatility_forecast'</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>volatility_forecasts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0      0.147481
1      0.150795
2      0.170141
3      0.147867
4      0.151963
         ...   
581    0.250594
582    0.242543
583    0.230967
584    0.188825
585    0.167192
Name: volatility_forecast, Length: 586, dtype: float64</code></pre>
</div>
</div>
<p>Next, letâ€™s use the <span class="math inline">\(R^2\)</span> metric that Sepp uses in his studies.</p>
<div id="cell-44" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>np.corrcoef(volatility_forecasts, df_realized[<span class="st">'realized_vol'</span>])[<span class="dv">0</span>,<span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.5612564282964889</code></pre>
</div>
</div>
<p>And finally, letâ€™s calculate the bias and efficiency.</p>
<div id="cell-46" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bias</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(volatility_forecasts <span class="op">-</span> df_realized[<span class="st">'realized_vol'</span>]))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># efficiency</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.std(df_realized[<span class="st">'realized_vol'</span>]) <span class="op">/</span> np.std(volatility_forecasts))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.1028763057503257
0.8233056504414178</code></pre>
</div>
</div>
</section>
<section id="references" class="level2" data-number="20.6">
<h2 data-number="20.6" class="anchored" data-anchor-id="references"><span class="header-section-number">20.6</span> References</h2>
<p><em>Does Anything Beat Garch(1, 1)</em> - Hansen and Lunde 2004</p>
<p><em>Options, Futures, and Other Derivatives 9th Edition</em> - John Hull (Chapter 23)</p>
<p><em>Volatility Modeling and Trading</em> - Artur Sepp 2016</p>
<p><a href="https://arch.readthedocs.io/en/latest/univariate/univariate_volatility_forecasting.html">https://arch.readthedocs.io/en/latest/univariate/univariate_volatility_forecasting.html</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/18_close_to_close/close_to_close.html" class="pagination-link" aria-label="Volatility Forecasting: Close-to-Close Estimator">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Volatility Forecasting: Close-to-Close Estimator</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/20_feed_grains_database/feed_grains_database.html" class="pagination-link" aria-label="Exploration of the Feed Grains Database">
        <span class="nav-page-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Exploration of the Feed Grains Database</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>