<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python for Data Science in Finance - 17&nbsp; Regression: Mutual Fund Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/18_close_to_close/close_to_close.html" rel="next">
<link href="../../chapters/16_trend_following/trend_following.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../parts/03_data_analysis/data_analysis.html">Data Analysis</a></li><li class="breadcrumb-item"><a href="../../chapters/17_regression_mutual_fund/regression_mutual_fund.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Regression: Mutual Fund Analysis</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Python for Data Science in Finance</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/01_jumpstart/jumpstart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Python Jumpstart</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../parts/01_part_basic_data_wrangling/part_basic_data_wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/02_dataframe_basics/dataframe_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><code>DataFrame</code> Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/03_index_slice/index_slice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><code>DataFrame</code> Indexing and Slicing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/04_query/query.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><code>DataFrame</code> Querying</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/05_functions_apply/functions_apply.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Functions and the <code>DataFrame.apply()</code> Method</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/06_merge/merge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Merging <code>DataFrames</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/07_groupby_aggregation_part_1/groupby_aggregation_part_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><code>.groupby()</code> and <code>.agg()</code> - 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/08_groupby_aggregation_part_2/groupby_aggregation_part_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title"><code>.groupby()</code> and <code>.agg()</code> - 2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../parts/02_part_visualization/part_visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/09_pandas_line_graphs/pandas_line_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Line Graphs with <strong>pandas</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/10_pandas_bar_charts/pandas_bar_charts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bar Charts with <strong>pandas</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/11_pandas_scatter_plots/pandas_scatter_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Scatter Plots with <strong>pandas</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/12_seaborn/seaborn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Visualization with <strong>seaborn</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/13_bokeh_basic/bokeh_basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Basic Plotting with <strong>bokeh</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/14_bokeh_advanced/bokeh_advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Advanced Plotting with <strong>bokeh</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../parts/03_data_analysis/data_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/15_option_replication/option_replication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Black-Scholes-Merton Option Replication</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/16_trend_following/trend_following.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Trend Following</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/17_regression_mutual_fund/regression_mutual_fund.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Regression: Mutual Fund Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/18_close_to_close/close_to_close.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Volatility Forecasting: Close-to-Close Estimator</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/19_garch/garch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Volatility Forecasting: GARCH</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/20_feed_grains_database/feed_grains_database.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Exploration of the Feed Grains Database</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../parts/04_classical_machine_learning/classical_machine_learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classical Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/21_simple_linear_regression/simple_linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Simple Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/22_categorical_linear_regression/categorical_linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Linear Regression with Categorical Variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/23_ridge_lasso_regression/ridge_lasso_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Ridge and Lasso Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/24_k_nearest_neighbors_cross_validation/k_nearest_neighbors_cross_validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">K Nearest Neighbors &amp; Cross-Validation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/25_stock_prediction/stock_prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Predicting Stock Returns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/26_pca/pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Principal Components Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/27_k_means_clustering/k_means_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">K-Means Clustering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/28_pca_visualization/pca_visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Visualizing Principal Components Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/29_student_loan_overfitting/student_loan_overfitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Student Loan: Overfitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/30_student_loan_alternative_metric/student_loan_alternative_metric.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Student Loan: Alternative Metric &amp; Cross-Validation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/31_student_loan_hyperparameter_tuning/student_loan_hyperparameter_tuning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Student Loan: Hyperparameter Tuning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/32_student_loan_xgboost/student_loan_xgboost.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Student Loan: <strong>xgboost</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/33_option_volume_introduction/option_volume_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Option Volume: Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/34_option_volume_feature_selection/option_volume_feature_selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Option Volume: Feature Selection and Hyperparameter Tuning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/35_option_volume_xgboost/option_volume_xgboost.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Option Volume: <strong>xgboost</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../parts/05_neural_networks/neural_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Neural Networks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/36_mnist_digit_recognition/mnist_digit_recognition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">MNIST Digit Recognition</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#loading-packages" id="toc-loading-packages" class="nav-link active" data-scroll-target="#loading-packages"><span class="header-section-number">17.1</span> Loading Packages</a></li>
  <li><a href="#reading-in-data" id="toc-reading-in-data" class="nav-link" data-scroll-target="#reading-in-data"><span class="header-section-number">17.2</span> Reading-In Data</a></li>
  <li><a href="#visualizing-raw-price-data" id="toc-visualizing-raw-price-data" class="nav-link" data-scroll-target="#visualizing-raw-price-data"><span class="header-section-number">17.3</span> Visualizing Raw Price Data</a></li>
  <li><a href="#tidying-the-data" id="toc-tidying-the-data" class="nav-link" data-scroll-target="#tidying-the-data"><span class="header-section-number">17.4</span> Tidying the Data</a></li>
  <li><a href="#visualizing-the-tidy-price-data-with-seaborn" id="toc-visualizing-the-tidy-price-data-with-seaborn" class="nav-link" data-scroll-target="#visualizing-the-tidy-price-data-with-seaborn"><span class="header-section-number">17.5</span> Visualizing the Tidy Price Data with <strong>seaborn</strong></a></li>
  <li><a href="#calculating-daily-returns-1" id="toc-calculating-daily-returns-1" class="nav-link" data-scroll-target="#calculating-daily-returns-1"><span class="header-section-number">17.6</span> Calculating Daily Returns (#1)</a></li>
  <li><a href="#rolling-252-day-return-2" id="toc-rolling-252-day-return-2" class="nav-link" data-scroll-target="#rolling-252-day-return-2"><span class="header-section-number">17.7</span> Rolling 252-day Return (#2)</a></li>
  <li><a href="#rolling-252-day-volatility-3" id="toc-rolling-252-day-volatility-3" class="nav-link" data-scroll-target="#rolling-252-day-volatility-3"><span class="header-section-number">17.8</span> Rolling 252-day Volatility (#3)</a></li>
  <li><a href="#quarterly-returns-and-excess-return-4" id="toc-quarterly-returns-and-excess-return-4" class="nav-link" data-scroll-target="#quarterly-returns-and-excess-return-4"><span class="header-section-number">17.9</span> Quarterly Returns and Excess Return (#4)</a></li>
  <li><a href="#wrangling-returns-data" id="toc-wrangling-returns-data" class="nav-link" data-scroll-target="#wrangling-returns-data"><span class="header-section-number">17.10</span> Wrangling Returns Data</a></li>
  <li><a href="#pair-plots-and-correlation-matrix-5" id="toc-pair-plots-and-correlation-matrix-5" class="nav-link" data-scroll-target="#pair-plots-and-correlation-matrix-5"><span class="header-section-number">17.11</span> Pair-Plots and Correlation Matrix (#5)</a></li>
  <li><a href="#regression-of-funds-against-benchmark-6-and-7" id="toc-regression-of-funds-against-benchmark-6-and-7" class="nav-link" data-scroll-target="#regression-of-funds-against-benchmark-6-and-7"><span class="header-section-number">17.12</span> Regression of Funds against Benchmark (#6 and #7)</a>
  <ul class="collapse">
  <li><a href="#fund-1" id="toc-fund-1" class="nav-link" data-scroll-target="#fund-1"><span class="header-section-number">17.12.1</span> Fund 1</a></li>
  <li><a href="#fund-2" id="toc-fund-2" class="nav-link" data-scroll-target="#fund-2"><span class="header-section-number">17.12.2</span> Fund 2</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Regression: Mutual Fund Analysis</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this chapter, we will use the skills that we have learned so far to analyze some mutual fund data. In particular, we have end of day NAVs from two different funds, called <code>fund_1</code> and <code>fund_2</code>, as well as benchmark index, called <code>benchmark</code>. The data spans from 2016Q1 to 2019Q3.</p>
<p>In our analysis we will do the following:</p>
<ol type="1">
<li>Calculate daily price returns for the benchmark and each of the two funds (ignoring dividends)</li>
<li>Calculate a rolling 250-day return for each fund and the benchmark, visualize the results.</li>
<li>Calculate a rolling 250-day volatility for each fund and the benchmark, visualize the results.</li>
<li>For each calendar quarter in the data set, calculate the excess return for each fund (vs the benchmark) and visualize this.</li>
<li>Create a correlation matrix of the three return histories (funds &amp; benchmark) using daily returns of the 2 most recent years.</li>
<li>Regress each of the two funds vs the benchmark and calculate beta, alpha, and <span class="math inline">\(R^2\)</span> using the most recent 2 years of data.</li>
<li>Visualize the two sets of linear regression results.</li>
</ol>
<section id="loading-packages" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="loading-packages"><span class="header-section-number">17.1</span> Loading Packages</h2>
<p>Let’s begin by importing the packages that we will need.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reading-in-data" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="reading-in-data"><span class="header-section-number">17.2</span> Reading-In Data</h2>
<p>Next, we’ll read-in the data, rename the columns, and convert the <code>trade_date</code> column to <code>datetime</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reading-in data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df_px_raw <span class="op">=</span> pd.read_csv(<span class="st">'mutual_fund_data.csv'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># renaming columns</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>df_px_raw.rename(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>{<span class="st">'Date'</span>:<span class="st">'trade_date'</span>, <span class="st">'BM'</span>:<span class="st">'benchmark'</span>, <span class="st">'Fund_1'</span>:<span class="st">'fund_1'</span>, <span class="st">'Fund_2'</span>:<span class="st">'fund_2'</span>}</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    , inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># converting data-type of trade_date</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>df_px_raw[<span class="st">'trade_date'</span>] <span class="op">=</span> pd.to_datetime(df_px_raw[<span class="st">'trade_date'</span>])</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>df_px_raw.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">benchmark</th>
<th data-quarto-table-cell-role="th">fund_1</th>
<th data-quarto-table-cell-role="th">fund_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2015-12-31</td>
<td>203.8700</td>
<td>108.29</td>
<td>254.04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-01-01</td>
<td>203.8700</td>
<td>108.29</td>
<td>254.04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2016-01-04</td>
<td>201.0192</td>
<td>106.61</td>
<td>250.82</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2016-01-05</td>
<td>201.3600</td>
<td>106.10</td>
<td>250.90</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2016-01-06</td>
<td>198.8200</td>
<td>104.66</td>
<td>247.36</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="visualizing-raw-price-data" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="visualizing-raw-price-data"><span class="header-section-number">17.3</span> Visualizing Raw Price Data</h2>
<p>The <strong>pandas</strong> package was created by Wes McKinney when he was a quant at the hedge fund AQR. Because of this, <strong>pandas</strong> was built with a lot of functionality that is particularly useful for working with financial timeseries. This includes some rudimentary plotting functionality, which is built on top of the package <strong>matplotlib</strong>.</p>
<p>Let’s quickly plot the price series for our three funds using the <code>DataFrame.plot()</code> method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df_px_raw.plot(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'trade_date'</span>, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>[<span class="st">'benchmark'</span>, <span class="st">'fund_1'</span>, <span class="st">'fund_2'</span>],</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">5</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Daily Fund Prices: 2016Q1-2019Q3'</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-4-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p><strong>Code Challenge:</strong> Copy and paste the code above and try setting <code>subplots=True</code>.</p>
<div class="cell">
<details>
<summary>Solution</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_px_raw.plot(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'trade_date'</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>[<span class="st">'benchmark'</span>, <span class="st">'fund_1'</span>, <span class="st">'fund_2'</span>],</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Fund Prices: 2016Q1-2019Q3'</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    subplots <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(top<span class="op">=</span><span class="fl">0.94</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-5-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
</section>
<section id="tidying-the-data" class="level2" data-number="17.4">
<h2 data-number="17.4" class="anchored" data-anchor-id="tidying-the-data"><span class="header-section-number">17.4</span> Tidying the Data</h2>
<p>Our data, in its current form, is not <em>tidy</em>. In order for data to be tidy, each row should be a single observation. Currently, each row of <code>df_px_raw</code> is three price observations - one for each of the three funds - which will not allow for easy use of the <code>.groupby()</code> function.</p>
<p>We can use the <code>pandas.melt()</code> method to tidy our data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df_px <span class="op">=</span> <span class="op">\</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    pd.melt(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        df_px_raw, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        id_vars <span class="op">=</span> [<span class="st">'trade_date'</span>],</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        value_vars <span class="op">=</span> [<span class="st">'benchmark'</span>, <span class="st">'fund_1'</span>, <span class="st">'fund_2'</span>], </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        var_name <span class="op">=</span> <span class="st">'symbol'</span>, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        value_name <span class="op">=</span> <span class="st">'close'</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>df_px.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2015-12-31</td>
<td>benchmark</td>
<td>203.8700</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-01-01</td>
<td>benchmark</td>
<td>203.8700</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2016-01-04</td>
<td>benchmark</td>
<td>201.0192</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2016-01-05</td>
<td>benchmark</td>
<td>201.3600</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2016-01-06</td>
<td>benchmark</td>
<td>198.8200</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Our analysis will involve calculating quarterly statistics, so let’s add columns <code>year</code>, <code>quarter</code>, and <code>month</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_px[<span class="st">'year'</span>] <span class="op">=</span> df_px[<span class="st">'trade_date'</span>].dt.year</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df_px[<span class="st">'quarter'</span>] <span class="op">=</span> df_px[<span class="st">'trade_date'</span>].dt.quarter</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df_px[<span class="st">'month'</span>] <span class="op">=</span> df_px[<span class="st">'trade_date'</span>].dt.month</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>df_px.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2015-12-31</td>
<td>benchmark</td>
<td>203.8700</td>
<td>2015</td>
<td>4</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-01-01</td>
<td>benchmark</td>
<td>203.8700</td>
<td>2016</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2016-01-04</td>
<td>benchmark</td>
<td>201.0192</td>
<td>2016</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2016-01-05</td>
<td>benchmark</td>
<td>201.3600</td>
<td>2016</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2016-01-06</td>
<td>benchmark</td>
<td>198.8200</td>
<td>2016</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s also rearrange columns to make our table a little more human readable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_px <span class="op">=</span> df_px[[<span class="st">'symbol'</span>,<span class="st">'trade_date'</span>, <span class="st">'year'</span>, <span class="st">'quarter'</span>, <span class="st">'month'</span>,  <span class="st">'close'</span>,]]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df_px.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>benchmark</td>
<td>2015-12-31</td>
<td>2015</td>
<td>4</td>
<td>12</td>
<td>203.8700</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>benchmark</td>
<td>2016-01-01</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>203.8700</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>benchmark</td>
<td>2016-01-04</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>201.0192</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>benchmark</td>
<td>2016-01-05</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>201.3600</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>benchmark</td>
<td>2016-01-06</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>198.8200</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="visualizing-the-tidy-price-data-with-seaborn" class="level2" data-number="17.5">
<h2 data-number="17.5" class="anchored" data-anchor-id="visualizing-the-tidy-price-data-with-seaborn"><span class="header-section-number">17.5</span> Visualizing the Tidy Price Data with <strong>seaborn</strong></h2>
<p>Let’s now import the <strong>seaborn</strong> package, which a popular visualization package that is also built on top of <strong>matplotlib</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the code below, we use <code>sns.relplot()</code> to graph the three fund price series using our data in its tidy form. Notice that by setting <code>hue='symbol'</code>, the <code>sns.relplot()</code> function knows to graph the <code>close</code> prices for each of the three <code>symbols</code> separately and with three different colors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="op">\</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sns.relplot(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> df_px, kind <span class="op">=</span> <span class="st">'line'</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">'trade_date'</span>, y <span class="op">=</span> <span class="st">'close'</span>, hue <span class="op">=</span> <span class="st">'symbol'</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    aspect <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># creating and tweaking the title</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>g.fig.suptitle(<span class="st">'Daily Fund Close Prices: 2016Q1-2019Q3'</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(top<span class="op">=</span><span class="fl">0.93</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="calculating-daily-returns-1" class="level2" data-number="17.6">
<h2 data-number="17.6" class="anchored" data-anchor-id="calculating-daily-returns-1"><span class="header-section-number">17.6</span> Calculating Daily Returns (#1)</h2>
<p>Notice that our data does not contain daily returns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_px.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>benchmark</td>
<td>2015-12-31</td>
<td>2015</td>
<td>4</td>
<td>12</td>
<td>203.8700</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>benchmark</td>
<td>2016-01-01</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>203.8700</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>benchmark</td>
<td>2016-01-04</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>201.0192</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>benchmark</td>
<td>2016-01-05</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>201.3600</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>benchmark</td>
<td>2016-01-06</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>198.8200</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now that our data is tidy, we can easily obtain daily log-returns using a grouped calculation.</p>
<p>We use log-returns because, they are very close in value to simple returns, and multi-day log-returns are easily calculated as sums of single-day returns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_px[<span class="st">'daily_ret'</span>] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    np.log(df_px[<span class="st">'close'</span>]).groupby(df_px[<span class="st">'symbol'</span>]).diff() <span class="co">#log returns</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df_px.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">daily_ret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>benchmark</td>
<td>2015-12-31</td>
<td>2015</td>
<td>4</td>
<td>12</td>
<td>203.8700</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>benchmark</td>
<td>2016-01-01</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>203.8700</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>benchmark</td>
<td>2016-01-04</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>201.0192</td>
<td>-0.014082</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>benchmark</td>
<td>2016-01-05</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>201.3600</td>
<td>0.001694</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>benchmark</td>
<td>2016-01-06</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>198.8200</td>
<td>-0.012694</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<hr>
<p><strong>Code Challenge:</strong> Verify that all the log-returns on the first date in the data set are <code>NaN</code>.</p>
<div class="cell">
<details>
<summary>Solution</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df_px[df_px[<span class="st">'trade_date'</span>] <span class="op">==</span> np.<span class="bu">min</span>(df_px[<span class="st">'trade_date'</span>])]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">daily_ret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>benchmark</td>
<td>2015-12-31</td>
<td>2015</td>
<td>4</td>
<td>12</td>
<td>203.87</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">978</td>
<td>fund_1</td>
<td>2015-12-31</td>
<td>2015</td>
<td>4</td>
<td>12</td>
<td>108.29</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1956</td>
<td>fund_2</td>
<td>2015-12-31</td>
<td>2015</td>
<td>4</td>
<td>12</td>
<td>254.04</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<hr>
</section>
<section id="rolling-252-day-return-2" class="level2" data-number="17.7">
<h2 data-number="17.7" class="anchored" data-anchor-id="rolling-252-day-return-2"><span class="header-section-number">17.7</span> Rolling 252-day Return (#2)</h2>
<p>Now that we have daily log-returns, we can easily calculate a rolling 252-day return by using the <code>.rolling()</code> method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df_px[<span class="st">'ret_252'</span>] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    df_px[<span class="st">'daily_ret'</span>].groupby(df_px[<span class="st">'symbol'</span>]).rolling(<span class="dv">252</span>).<span class="bu">sum</span>().values</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>df_px.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">daily_ret</th>
<th data-quarto-table-cell-role="th">ret_252</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>benchmark</td>
<td>2015-12-31</td>
<td>2015</td>
<td>4</td>
<td>12</td>
<td>203.8700</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>benchmark</td>
<td>2016-01-01</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>203.8700</td>
<td>0.000000</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>benchmark</td>
<td>2016-01-04</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>201.0192</td>
<td>-0.014082</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>benchmark</td>
<td>2016-01-05</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>201.3600</td>
<td>0.001694</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>benchmark</td>
<td>2016-01-06</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>198.8200</td>
<td>-0.012694</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Next we’ll use <code>sns.FacetGrid()</code> to graph three separate subplots of the rolling returns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(df_px, col<span class="op">=</span><span class="st">'symbol'</span>, aspect<span class="op">=</span><span class="fl">1.25</span>, height<span class="op">=</span><span class="dv">3</span>,)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>g.<span class="bu">map</span>(plt.plot, <span class="st">'trade_date'</span>, <span class="st">'ret_252'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>,)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>g.add_legend()<span class="op">;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>g.set_xticklabels(rotation<span class="op">=</span><span class="dv">35</span>, horizontalalignment<span class="op">=</span><span class="st">'right'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p><strong>Code Challenge:</strong> Copy and paste the code above, and try changing <code>col='symbol'</code> to <code>row='symbol'</code>.</p>
<div class="cell">
<details>
<summary>Solution</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(df_px, row<span class="op">=</span><span class="st">'symbol'</span>, aspect<span class="op">=</span><span class="fl">1.25</span>, height<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>g.<span class="bu">map</span>(plt.plot, <span class="st">'trade_date'</span>, <span class="st">'ret_252'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, )</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>g.add_legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
</section>
<section id="rolling-252-day-volatility-3" class="level2" data-number="17.8">
<h2 data-number="17.8" class="anchored" data-anchor-id="rolling-252-day-volatility-3"><span class="header-section-number">17.8</span> Rolling 252-day Volatility (#3)</h2>
<p>We can calculate a rolling 252-day volatility in a similar fashion as the rolling returns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_px[<span class="st">'vol_252'</span>] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    df_px[<span class="st">'daily_ret'</span>].groupby(df_px[<span class="st">'symbol'</span>]).rolling(<span class="dv">252</span>).std().values <span class="op">*</span> np.sqrt(<span class="dv">252</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>df_px.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">daily_ret</th>
<th data-quarto-table-cell-role="th">ret_252</th>
<th data-quarto-table-cell-role="th">vol_252</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>benchmark</td>
<td>2015-12-31</td>
<td>2015</td>
<td>4</td>
<td>12</td>
<td>203.8700</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>benchmark</td>
<td>2016-01-01</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>203.8700</td>
<td>0.000000</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>benchmark</td>
<td>2016-01-04</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>201.0192</td>
<td>-0.014082</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>benchmark</td>
<td>2016-01-05</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>201.3600</td>
<td>0.001694</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>benchmark</td>
<td>2016-01-06</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>198.8200</td>
<td>-0.012694</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This code creates a <code>seaborn.FacetGrid()</code> of the rolling volatilities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(df_px, col<span class="op">=</span><span class="st">'symbol'</span>, aspect<span class="op">=</span><span class="fl">1.25</span>, height<span class="op">=</span><span class="dv">3</span>,)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>g.<span class="bu">map</span>(plt.plot, <span class="st">'trade_date'</span>, <span class="st">'vol_252'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>g.set_xticklabels(rotation<span class="op">=</span><span class="dv">35</span>, horizontalalignment<span class="op">=</span><span class="st">'right'</span>)<span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>g.add_legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The following code uses <strong>pandas</strong> to graph the rolling returns and volatility on the same plot for <code>fund_1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filtering conditions</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>bln_symbol <span class="op">=</span> df_px[<span class="st">'symbol'</span>] <span class="op">==</span> <span class="st">'fund_1'</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>bln_nans <span class="op">=</span> <span class="op">~</span>(np.isnan(df_px[<span class="st">'ret_252'</span>]))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>bln_filter <span class="op">=</span> bln_symbol <span class="op">&amp;</span> bln_nans</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># graphing</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>df_px[bln_filter].plot(x<span class="op">=</span><span class="st">'trade_date'</span>, y<span class="op">=</span>[<span class="st">'ret_252'</span>, <span class="st">'vol_252'</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Code Challenge</strong> Copy and paste the above code and modify it to graph only the data from the beginning of 2019 and onwards.</p>
<div class="cell">
<details>
<summary>Solution</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>bln_symbol <span class="op">=</span> df_px[<span class="st">'symbol'</span>] <span class="op">==</span> <span class="st">'fund_1'</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>bln_date <span class="op">=</span> df_px[<span class="st">'trade_date'</span>] <span class="op">&gt;=</span> <span class="st">'2019-01-01'</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>bln_filter <span class="op">=</span> bln_symbol <span class="op">&amp;</span> bln_date</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>df_px[bln_filter].plot(x<span class="op">=</span><span class="st">'trade_date'</span>, y<span class="op">=</span>[<span class="st">'ret_252'</span>, <span class="st">'vol_252'</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="quarterly-returns-and-excess-return-4" class="level2" data-number="17.9">
<h2 data-number="17.9" class="anchored" data-anchor-id="quarterly-returns-and-excess-return-4"><span class="header-section-number">17.9</span> Quarterly Returns and Excess Return (#4)</h2>
<p>Our next analysis objective is to calculate quarterly excess returns for <code>fund_1</code> and <code>fund_2</code> relative the <code>benchmark</code>.</p>
<p>As we can see, <code>df_px</code> consist of daily data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df_px.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">close</th>
<th data-quarto-table-cell-role="th">daily_ret</th>
<th data-quarto-table-cell-role="th">ret_252</th>
<th data-quarto-table-cell-role="th">vol_252</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>benchmark</td>
<td>2015-12-31</td>
<td>2015</td>
<td>4</td>
<td>12</td>
<td>203.8700</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>benchmark</td>
<td>2016-01-01</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>203.8700</td>
<td>0.000000</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>benchmark</td>
<td>2016-01-04</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>201.0192</td>
<td>-0.014082</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>benchmark</td>
<td>2016-01-05</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>201.3600</td>
<td>0.001694</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>benchmark</td>
<td>2016-01-06</td>
<td>2016</td>
<td>1</td>
<td>1</td>
<td>198.8200</td>
<td>-0.012694</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Calculating the quarterly returns is a straight-forward application of <code>.groupby().agg()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df_quarter <span class="op">=</span> <span class="op">\</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    df_px[df_px.year <span class="op">&gt;</span> <span class="dv">2015</span>] <span class="op">\</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'symbol'</span>, <span class="st">'year'</span>, <span class="st">'quarter'</span>])[<span class="st">'daily_ret'</span>].agg([np.<span class="bu">sum</span>]).reset_index() <span class="op">\</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        .rename(columns<span class="op">=</span>{<span class="st">'sum'</span>:<span class="st">'quarterly_ret'</span>})</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>df_quarter.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">quarterly_ret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>benchmark</td>
<td>2016</td>
<td>1</td>
<td>0.008061</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>benchmark</td>
<td>2016</td>
<td>2</td>
<td>0.019061</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>benchmark</td>
<td>2016</td>
<td>3</td>
<td>0.032062</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>benchmark</td>
<td>2016</td>
<td>4</td>
<td>0.032879</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>benchmark</td>
<td>2017</td>
<td>1</td>
<td>0.053184</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Since we ultimately want to calculate excess return relative to the <code>benchmark</code>, it would be helpful to have the <code>benchmark</code> returns as a separate column in <code>df_quarter</code>.</p>
<p>In order to do this, let’s first separate out the <code>benchmark</code> quarterly returns into a separate <code>DataFrame</code> called <code>df_bench</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df_bench <span class="op">=</span> <span class="op">\</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    df_quarter[df_quarter[<span class="st">'symbol'</span>] <span class="op">==</span> <span class="st">'benchmark'</span>] <span class="op">\</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    [[<span class="st">'year'</span>, <span class="st">'quarter'</span>, <span class="st">'quarterly_ret'</span>]] <span class="op">\</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">'quarterly_ret'</span>:<span class="st">'bench_ret'</span>})</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>df_bench.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">bench_ret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2016</td>
<td>1</td>
<td>0.008061</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2016</td>
<td>2</td>
<td>0.019061</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2016</td>
<td>3</td>
<td>0.032062</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2016</td>
<td>4</td>
<td>0.032879</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2017</td>
<td>1</td>
<td>0.053184</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In order to add the <code>bench_ret</code> column to <code>df_quarter</code> we will utilize a <code>left-join</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_excess <span class="op">=</span> <span class="op">\</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    pd.merge(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        df_quarter, df_bench, how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        left_on<span class="op">=</span>[<span class="st">'year'</span>,<span class="st">'quarter'</span>], right_on<span class="op">=</span>[<span class="st">'year'</span>, <span class="st">'quarter'</span>]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>df_excess.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">quarterly_ret</th>
<th data-quarto-table-cell-role="th">bench_ret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>benchmark</td>
<td>2016</td>
<td>1</td>
<td>0.008061</td>
<td>0.008061</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>benchmark</td>
<td>2016</td>
<td>2</td>
<td>0.019061</td>
<td>0.019061</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>benchmark</td>
<td>2016</td>
<td>3</td>
<td>0.032062</td>
<td>0.032062</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>benchmark</td>
<td>2016</td>
<td>4</td>
<td>0.032879</td>
<td>0.032879</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>benchmark</td>
<td>2017</td>
<td>1</td>
<td>0.053184</td>
<td>0.053184</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Finally, we can caluclate excess return for each of the funds.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_excess[<span class="st">'excess_ret'</span>] <span class="op">=</span> df_excess[<span class="st">'quarterly_ret'</span>] <span class="op">-</span> df_excess[<span class="st">'bench_ret'</span>]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>df_excess[<span class="st">'year_quarter'</span>] <span class="op">=</span> df_excess[<span class="st">'year'</span>] <span class="op">*</span> <span class="dv">100</span> <span class="op">+</span> df_excess[<span class="st">'quarter'</span>]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>df_excess <span class="op">=</span> df_excess[[<span class="st">'symbol'</span>, <span class="st">'year'</span>, <span class="st">'quarter'</span>, <span class="st">'year_quarter'</span>, <span class="st">'quarterly_ret'</span>, <span class="st">'bench_ret'</span>, <span class="st">'excess_ret'</span>]]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>df_excess.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">year_quarter</th>
<th data-quarto-table-cell-role="th">quarterly_ret</th>
<th data-quarto-table-cell-role="th">bench_ret</th>
<th data-quarto-table-cell-role="th">excess_ret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>benchmark</td>
<td>2016</td>
<td>1</td>
<td>201601</td>
<td>0.008061</td>
<td>0.008061</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>benchmark</td>
<td>2016</td>
<td>2</td>
<td>201602</td>
<td>0.019061</td>
<td>0.019061</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>benchmark</td>
<td>2016</td>
<td>3</td>
<td>201603</td>
<td>0.032062</td>
<td>0.032062</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>benchmark</td>
<td>2016</td>
<td>4</td>
<td>201604</td>
<td>0.032879</td>
<td>0.032879</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>benchmark</td>
<td>2017</td>
<td>1</td>
<td>201701</td>
<td>0.053184</td>
<td>0.053184</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Next, we create a bar-plot with of the three funds quarterly returns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="op">\</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    sns.catplot(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df_excess, x<span class="op">=</span><span class="st">"year_quarter"</span>, y<span class="op">=</span><span class="st">"quarterly_ret"</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        hue<span class="op">=</span><span class="st">"symbol"</span>, kind<span class="op">=</span><span class="st">"bar"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        aspect<span class="op">=</span> <span class="fl">1.65</span>, </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>g.fig.suptitle(<span class="st">'Fund Quarterly Returns'</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>g.set_xticklabels(rotation<span class="op">=</span><span class="dv">35</span>, horizontalalignment<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(top<span class="op">=</span><span class="fl">0.93</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>And finally, we create a bar-plot of the excess returns of <code>fund_1</code> and <code>fund_2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="op">\</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    sns.catplot(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df_excess[df_excess.symbol <span class="op">!=</span> <span class="st">'benchmark'</span>],</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"year_quarter"</span>, y<span class="op">=</span><span class="st">"excess_ret"</span>, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        hue<span class="op">=</span><span class="st">"symbol"</span>, kind<span class="op">=</span><span class="st">"bar"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        aspect<span class="op">=</span><span class="fl">1.5</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>g.fig.suptitle(<span class="st">'Quarterly Excess Returns: fund_1 &amp; fund_2'</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>g.set_xticklabels(rotation<span class="op">=</span><span class="dv">35</span>, horizontalalignment<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(top<span class="op">=</span><span class="fl">0.93</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="wrangling-returns-data" class="level2" data-number="17.10">
<h2 data-number="17.10" class="anchored" data-anchor-id="wrangling-returns-data"><span class="header-section-number">17.10</span> Wrangling Returns Data</h2>
<p>For the remainder of the tutorial, will be helpful to have an <em>untidy</em> <code>DataFrame</code> with the daily returns for the three funds in separate columns.</p>
<p>Let’s first separate out the returns for each fund into their own <code>DataFrames</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">'trade_date'</span>, <span class="st">'daily_ret'</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df_bench <span class="op">=</span> <span class="op">\</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    df_px[df_px.symbol <span class="op">==</span> <span class="st">'benchmark'</span>][cols].copy().rename(columns<span class="op">=</span>{<span class="st">'daily_ret'</span>:<span class="st">'benchmark'</span>})</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>df_fund1 <span class="op">=</span> <span class="op">\</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    df_px[df_px.symbol <span class="op">==</span> <span class="st">'fund_1'</span>][cols].copy().rename(columns<span class="op">=</span>{<span class="st">'daily_ret'</span>:<span class="st">'fund_1'</span>})</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>df_fund2 <span class="op">=</span> <span class="op">\</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    df_px[df_px.symbol <span class="op">==</span> <span class="st">'fund_2'</span>][cols].copy().rename(columns<span class="op">=</span>{<span class="st">'daily_ret'</span>:<span class="st">'fund_2'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we <code>left-join</code> these three <code>DataFrames</code> together into a single variable called <code>df_ret</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df_ret <span class="op">=</span> <span class="op">\</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    df_bench <span class="op">\</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>        .merge(right<span class="op">=</span>df_fund1, how<span class="op">=</span><span class="st">'left'</span>, left_on<span class="op">=</span><span class="st">'trade_date'</span>, right_on<span class="op">=</span><span class="st">'trade_date'</span>) <span class="op">\</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>        .merge(right<span class="op">=</span>df_fund2, how<span class="op">=</span><span class="st">'left'</span>, left_on<span class="op">=</span><span class="st">'trade_date'</span>, right_on<span class="op">=</span><span class="st">'trade_date'</span>) <span class="op">\</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>        .query(<span class="st">'trade_date &gt; "2015-12-31"'</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>df_ret.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">trade_date</th>
<th data-quarto-table-cell-role="th">benchmark</th>
<th data-quarto-table-cell-role="th">fund_1</th>
<th data-quarto-table-cell-role="th">fund_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-01-01</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>2016-01-04</td>
<td>-0.014082</td>
<td>-0.015635</td>
<td>-0.012756</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>2016-01-05</td>
<td>0.001694</td>
<td>-0.004795</td>
<td>0.000319</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>2016-01-06</td>
<td>-0.012694</td>
<td>-0.013665</td>
<td>-0.014210</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>2016-01-07</td>
<td>-0.024284</td>
<td>-0.032729</td>
<td>-0.025882</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="pair-plots-and-correlation-matrix-5" class="level2" data-number="17.11">
<h2 data-number="17.11" class="anchored" data-anchor-id="pair-plots-and-correlation-matrix-5"><span class="header-section-number">17.11</span> Pair-Plots and Correlation Matrix (#5)</h2>
<p>In a subsequent section, we will perform regressions on the two most recent years of data.</p>
<p>Prior to modeling, I find it useful to look at scatter plots and correlations.</p>
<p>As a first step, let’s programmatically calculate the start date for our analysis. We will utilize the <code>numpy.timedelta</code> data structure for this purpose.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dt_curr <span class="op">=</span> df_ret.sort_values([<span class="st">'trade_date'</span>])[<span class="op">-</span><span class="dv">1</span>:][<span class="st">'trade_date'</span>].values[<span class="dv">0</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>dt_start <span class="op">=</span> dt_curr <span class="op">-</span> np.timedelta64(<span class="dv">730</span>, <span class="st">'D'</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt_curr)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt_start)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2019-09-30T00:00:00.000000000
2017-09-30T00:00:00.000000000</code></pre>
</div>
</div>
<p>Next, we use the <code>seaborn.pairplot()</code> function to quickly graph all the pairwise correlatior for two years of fund data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">'benchmark'</span>, <span class="st">'fund_1'</span>, <span class="st">'fund_2'</span>]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>sns.pairplot(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    df_ret[df_ret[<span class="st">'trade_date'</span>] <span class="op">&gt;</span> dt_start][cols]</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Clearly all three of our returns are highly correlated.</p>
<p>Let’s use the <code>DataFrame.corr()</code> method to calculate the correlations explicitly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">'benchmark'</span>, <span class="st">'fund_1'</span>, <span class="st">'fund_2'</span>]</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df_ret[df_ret[<span class="st">'trade_date'</span>] <span class="op">&gt;</span> dt_start][cols].corr()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">benchmark</th>
<th data-quarto-table-cell-role="th">fund_1</th>
<th data-quarto-table-cell-role="th">fund_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">benchmark</td>
<td>1.000000</td>
<td>0.927068</td>
<td>0.919859</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">fund_1</td>
<td>0.927068</td>
<td>1.000000</td>
<td>0.836144</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fund_2</td>
<td>0.919859</td>
<td>0.836144</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<hr>
<p><strong>Code Challenge:</strong> Copy and paste the above correlation code and modify it calculate the correlations for the entirety of the data set.</p>
<div class="cell">
<details>
<summary>Solution</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">'benchmark'</span>, <span class="st">'fund_1'</span>, <span class="st">'fund_2'</span>]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df_ret[cols].corr()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">benchmark</th>
<th data-quarto-table-cell-role="th">fund_1</th>
<th data-quarto-table-cell-role="th">fund_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">benchmark</td>
<td>1.000000</td>
<td>0.914292</td>
<td>0.914148</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">fund_1</td>
<td>0.914292</td>
<td>1.000000</td>
<td>0.812403</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fund_2</td>
<td>0.914148</td>
<td>0.812403</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<hr>
</section>
<section id="regression-of-funds-against-benchmark-6-and-7" class="level2" data-number="17.12">
<h2 data-number="17.12" class="anchored" data-anchor-id="regression-of-funds-against-benchmark-6-and-7"><span class="header-section-number">17.12</span> Regression of Funds against Benchmark (#6 and #7)</h2>
<p>Finally, we will fit regressions of <code>fund_1</code> and <code>fund_2</code> against the <code>benchmark</code>.</p>
<p>In order to do this, we will utilize the <strong>sklearn</strong> package which is extremely useful for implementing a variety of machine learning techniques.</p>
<p>Let’s begin by importing the <code>LinearRegression()</code> constructor function from <strong>sklearn</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We again want to restrict our analysis to the most recent two years, so let’s recalculate <code>dt_start</code> just for good measure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>dt_curr <span class="op">=</span> df_ret.sort_values([<span class="st">'trade_date'</span>])[<span class="op">-</span><span class="dv">1</span>:][<span class="st">'trade_date'</span>].values[<span class="dv">0</span>]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>dt_start <span class="op">=</span> dt_curr <span class="op">-</span> np.timedelta64(<span class="dv">730</span>, <span class="st">'D'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="fund-1" class="level3" data-number="17.12.1">
<h3 data-number="17.12.1" class="anchored" data-anchor-id="fund-1"><span class="header-section-number">17.12.1</span> Fund 1</h3>
<p>Let’s begin by regressing <code>fund_1</code> against the <code>benchmark</code>.</p>
<p>As a preliminary step, let’s graph the scatter plot of the returns series.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df_ret <span class="op">\</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    [df_ret.trade_date <span class="op">&gt;</span> dt_start] <span class="op">\</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    .plot.scatter(<span class="st">'benchmark'</span>, <span class="st">'fund_1'</span>, c<span class="op">=</span><span class="st">'k'</span>, figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The first step in using <strong>sklearn</strong> for a regression analysis is to instantiate a regression model object as assign it to a variable, which we will call <code>reg_fund1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>reg_fund1 <span class="op">=</span> LinearRegression(fit_intercept<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, let’s separate out the <code>benchmark</code> returns and the <code>fund_1</code> returns into their own <code>DataFrames</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_bm <span class="op">=</span> df_ret[[<span class="st">'benchmark'</span>]][df_ret.trade_date <span class="op">&gt;</span> dt_start]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>df_fund1 <span class="op">=</span> df_ret[[<span class="st">'fund_1'</span>]][df_ret.trade_date <span class="op">&gt;</span> dt_start]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To fit the regression we call the <code>.fit()</code> method of our model object <code>reg_fund1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>reg_fund1.fit(X <span class="op">=</span> df_bm, y <span class="op">=</span> df_fund1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LinearRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div>
</div>
</div>
<p>The coefficients <span class="math inline">\((\beta)\)</span> and the y-intercept <span class="math inline">\((\alpha)\)</span> are attributes of <code>reg_fund1</code> which we can access as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"beta:  "</span> <span class="op">+</span> <span class="bu">str</span>(np.<span class="bu">round</span>(reg_fund1.coef_[<span class="dv">0</span>, <span class="dv">0</span>], <span class="dv">4</span>)))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"alpha: "</span> <span class="op">+</span> <span class="bu">str</span>(np.<span class="bu">round</span>(reg_fund1.intercept_[<span class="dv">0</span>], <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>beta:  1.2982
alpha: 0.0003</code></pre>
</div>
</div>
<p>Every class of machine learning model has a <code>.score()</code> method, which gives some kind of accuracy measure. For <code>LinearRegression</code> the <code>.score()</code> gives the <span class="math inline">\(R^2\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>reg_fund1.score(df_ret[[<span class="st">'benchmark'</span>]], df_ret[[<span class="st">'fund_1'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.8349465372078845</code></pre>
</div>
</div>
<p>Let’s use <strong>pandas</strong> plotting along with <code>matplotlib.pyplot</code> to graph our regression line along with the scatter plot of the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>xfit <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="dv">100</span>)           <span class="co"># range of line</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>yfit <span class="op">=</span> reg_fund1.predict(xfit[:, np.newaxis])  <span class="co"># model values in range</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>df_ret <span class="op">\</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    [df_ret.trade_date <span class="op">&gt;</span> dt_start] <span class="op">\</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    .plot.scatter(<span class="st">'benchmark'</span>, <span class="st">'fund_1'</span>, c<span class="op">=</span><span class="st">'k'</span>, figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))<span class="op">;</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>plt.plot(xfit, yfit)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/pritam/.local/lib/python3.10/site-packages/sklearn/base.py:439: UserWarning: X does not have valid feature names, but LinearRegression was fitted with feature names
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-42-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="fund-2" class="level3" data-number="17.12.2">
<h3 data-number="17.12.2" class="anchored" data-anchor-id="fund-2"><span class="header-section-number">17.12.2</span> Fund 2</h3>
<p>Let’s implement the same kind of regression analysis for <code>fund_2</code>.</p>
<p><strong>Scatter Plot of <code>fund_2</code> vs <code>benchmark</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df_ret<span class="op">\</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    [df_ret.trade_date <span class="op">&gt;</span> dt_start]<span class="op">\</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    .plot.scatter(<span class="st">'benchmark'</span>, <span class="st">'fund_2'</span>, c<span class="op">=</span><span class="st">'k'</span>, figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-43-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Instantiate a <code>LinearRegression</code> Object</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>reg_fund2 <span class="op">=</span> LinearRegression(fit_intercept<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Separate out Features and Labels for Regression Analysis</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df_bm <span class="op">=</span> df_ret[[<span class="st">'benchmark'</span>]][df_ret.trade_date <span class="op">&gt;</span> dt_start]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>df_fund2 <span class="op">=</span> df_ret[[<span class="st">'fund_2'</span>]][df_ret.trade_date <span class="op">&gt;</span> dt_start]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Fit the Regression Model</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>reg_fund2.fit(X <span class="op">=</span> df_bm, y <span class="op">=</span> df_fund2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LinearRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div>
</div>
</div>
<p><strong>Print Coefficients</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(reg_fund2.coef_)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(reg_fund2.intercept_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0.94373491]]
[-0.00015386]</code></pre>
</div>
</div>
<p><strong>Check the <span class="math inline">\(R^2\)</span></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>reg_fund2.score(df_ret[[<span class="st">'benchmark'</span>]], df_ret[[<span class="st">'fund_1'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.7823936517887883</code></pre>
</div>
</div>
<p><strong>Plot the Fitted Regression Line</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>xfit <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="dv">100</span>)           <span class="co"># range of line</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>yfit <span class="op">=</span> reg_fund2.predict(xfit[:, np.newaxis])  <span class="co"># model values in range</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>df_ret <span class="op">\</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    [df_ret.trade_date <span class="op">&gt;</span> dt_start] <span class="op">\</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    .plot.scatter(<span class="st">'benchmark'</span>, <span class="st">'fund_2'</span>, c<span class="op">=</span><span class="st">'k'</span>, figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))<span class="op">;</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>plt.plot(xfit, yfit)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/pritam/.local/lib/python3.10/site-packages/sklearn/base.py:439: UserWarning: X does not have valid feature names, but LinearRegression was fitted with feature names
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="regression_mutual_fund_files/figure-html/cell-49-output-2.png" class="img-fluid"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/16_trend_following/trend_following.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Trend Following</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/18_close_to_close/close_to_close.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Volatility Forecasting: Close-to-Close Estimator</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>